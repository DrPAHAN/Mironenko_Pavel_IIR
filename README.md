# Детектор Прямоугольных Объектов с OpenCV

Этот проект представляет собой скрипт на Python, использующий библиотеку OpenCV для обнаружения прямоугольных объектов (квадратов и прямоугольников) на изображениях. Код основан на методе аппроксимации контуров и анализе их свойств, как описано в туториале [PyImageSearch](https://pyimagesearch.com/2016/02/08/opencv-shape-detection/). Проект включает класс `ShapeDetector` для идентификации фигур и скрипт для обработки изображений с визуализацией результатов.

## Требования

- Python 3.x
- Библиотека OpenCV (`opencv-python`)
- Аргументы командной строки (встроенный модуль `argparse`)

### Установка зависимостей

1. Убедитесь, что у вас установлен Python 3:
   ```bash
   python3 --version
   ```
2. Установите OpenCV с помощью pip:
   ```bash
   pip3 install opencv-python
   ```
3. Проверьте установку:
   ```bash
   python3 -c "import cv2; print(cv2.__version__)"
   ```
4. Установите все зависимости из файла `requirements.txt`:
   ```bash
   pip3 install -r requirements.txt
   ```

## Установка и запуск

### 1. Сохранение кода
Скопируйте код из файла `detect_rectangles.py` в вашу рабочую директорию и сохраните его.

### 2. Подготовка тестового изображения
- Создайте или используйте изображение с прямоугольными объектами (например, `test_image.jpg`).
- Изображение должно содержать четкие прямоугольники или квадраты на контрастном фоне (например, белые на черном).
- Для тестирования можно использовать скрипт `generate_test_images.py` (если доступен) для создания файлов `test_image_1.jpg` и `test_image_2.jpg`.

### 3. Запуск скрипта
Откройте терминал в директории с файлом `detect_rectangles.py` и выполните:
```bash
python3 detect_rectangles.py --image путь/к/изображению/test_image.jpg
```
- Замените `путь/к/изображению/test_image.jpg` на реальный путь к вашему изображению.
- Примеры:
  - Если изображение в той же папке:
    ```bash
    python3 detect_rectangles.py --image test_image.jpg
    ```
  - С измененным порогом и сохранением результата:
    ```bash
    python3 detect_rectangles.py --image test_image.jpg --threshold 50 --output result.jpg
    ```

### 4. Результат
- Откроется окно с изображением, где прямоугольные объекты будут обведены зеленой линией с надписью "rectangle" в центре.
- В консоли отобразится количество найденных прямоугольных объектов (например, `Найдено 3 прямоугольных объектов`).
- Если указан аргумент `--output`, результирующее изображение сохранится в указанный файл (например, `result.jpg`), и будет выведено сообщение об успехе.
- Нажмите любую клавишу, чтобы закрыть окно.

## Описание кода

### Функциональность

- **Класс `ShapeDetector`**: Определяет форму контура на основе количества вершин и соотношения сторон (aspect ratio).
  - Прямоугольники и квадраты идентифицируются, если у контура 4 вершины.
  - Соотношение сторон 0.95–1.05 классифицирует фигуру как квадрат, иначе — как прямоугольник.
- **Предобработка**: Изображение уменьшается до ширины 300 пикселей, преобразуется в градации серого, размыкается и бинаризуется с порогом, заданным параметром `--threshold` (по умолчанию 60).
- **Обнаружение**: Контуры находят с помощью `cv2.findContours`, а прямоугольные объекты фильтруются и визуализируются.

### Ограничения
- Код работает только с прямоугольными объектами (4 вершины).
- Порог бинаризации может потребовать настройки в зависимости от изображения.

### Возможности настройки
- **Порог бинаризации**: Указывается с помощью аргумента `--threshold` (по умолчанию 60). Для автоматического определения порога можно использовать метод Otsu, заменив в коде:
  ```python
  thresh = cv2.threshold(blurred, args["threshold"], 255, cv2.THRESH_BINARY)[1]
  ```
  на:
  ```python
  thresh = cv2.threshold(blurred, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)[1]
  ```
- **Сохранение результата**: Укажите путь с помощью аргумента `--output`.


## Ожидаемый результат
- **Окно с визуализацией**: Прямоугольники обведены зеленым, с надписью "rectangle".
- **Консоль**: `Найдено X прямоугольных объектов`, где X — количество найденных фигур.
- **Сохранение**: Если указан `--output`, файл сохраняется с визуализацией.

